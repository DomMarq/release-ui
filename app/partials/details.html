<div ng-controller="DetailsController">

  <nav id="top-bar" class="navbar sticky-top navbar-light">
    <div class="navbar-header">
      <a id="top-bar-content" class="navbar-brand" href="" ng-click="homePage()">
        <img src="/app/assets/images/logo.png" style="width:20%;">
        <span>ISTIO Releases</span>
      </a>
    </div>
  </nav>

  <main class="container p-5">
    <div id="title" class="row">
      <div class="col-" id = "release-image">
        <img ng-if="release.state == 2" src="/app/assets/images/check.png">
        <img ng-if="release.state == 3" src="/app/assets/images/error.png">
        <img ng-if="release.state == 1" src="/app/assets/images/pending.png">
        <img ng-if="release.state == 4" src="/app/assets/images/suspended.png">
      </div>
      <div class="col-xl-">
        <h1 id="detail_release_title"> {{ release.name }} </h1>
      </div>
    </div>

    <div style="float:right;" class="btn-group-vertical">
      <a href="{{release.repo_url}}" target="_blank" ><button type="button" style="width:120px;" class="link btn btn-primary btn-lg">Repo Link</button></a>
      <a href="{{release.artifacts_link}}" target="_blank"><button type="button" style="width:120px;" class="btn btn-primary btn-lg link">Artifacts Link</button></a>
      <a href="{{release.release_url}}" target="_blank"><button type="button" style="width:120px;" class="btn btn-primary btn-lg link">Release Link</button></a>
    </div>

    <div class="row" id="labels">
      <button ng-if="release.stage == 1" type="button" class="btn btn-info btn-sm">Initializing</button>
      <button ng-if="release.stage == 2" type="button" class="btn btn-info btn-sm">Building</button>
      <button ng-if="release.stage == 3" type="button" class="btn btn-info btn-sm">Qualifying</button>
      <button ng-if="release.stage == 4" type="button" class="btn btn-info btn-sm">Publishing</button>
      <button ng-if="release.stage == 5" type="button" class="btn btn-info btn-sm">Tagging</button>
      <button ng-if="release.stage == 6" type="button" class="btn btn-info btn-sm">Finalizing</button>
      <button ng-if="release.stage == 7" type="button" class="btn btn-info btn-sm">Done</button>
      <button ng-repeat="tag in release.labels "type="button" class="btn btn-secondary btn-sm">
        {{tag}}
      </button>
    </div>

    <div id="dates">
      <div class="row">
        <div class="col">
          <h6>Created on: {{release.started * 1000 | date:'medium'}}</h6>
        </div>
      </div>
      <div class="row">
        <div class="col">
          <h6>Last Modified: {{release.last_modified * 1000 | date:'medium'}}</h6>
        </div>
      </div>
    </div>


    <div id="detail-table">
      <table class="table">
        <thead>
          <th>Status</th>
          <th>Task</th>
          <th>Start Time</th>
          <th>Last Modified</th>
          <th>Dependencies</th>
          <th>View Logs</th>
        </thead>
        <tbody>
            <tr ng-class="{greyed: hover}" ng-mouseenter="hover = true" ng-mouseleave="hover = false" ng-repeat-start="task in tasks | orderBy:'-started'" ng-click="task.expanded = !task.expanded">
              <td>
                <img ng-if="task.status == 2" src="/app/assets/images/check.png">
                <img ng-if="task.status == 3" src="/app/assets/images/error.png">
                <img ng-if="task.status == 1" src="/app/assets/images/pending.png">
                <img ng-if="task.status == 4" src="/app/assets/images/suspended.png">
              </td>
              <td>
                {{ task.task_name }}
              </td>
              <td>
                {{task.started * 1000 | date:"MM/dd/yyyy 'at' h:mma"}}
              </td>
              <td>
                {{task.last_modified * 1000 | date:"MM/dd/yyyy 'at' h:mma"}}
              </td>
              <td>
                <button ng-if="task.dependent_on.length == 0" type="button" class="btn btn-sm">
                  None
                </button>
                <button ng-if="task.dependent_on.length != 0" ng-repeat="tag in task.dependent_on" type="button" class="btn btn-sm">
                  {{tag}}
                </button>
              </td>
              <td>
                <a href="{{task.log_url}}" target="_blank"> logs </a>
              </td>
            </tr>
            <tr ng-if="task.expanded" ng-repeat-end="">
              <td colspan="6"><b>ERROR:</b> {{task.error}}</td>
            </tr>
        </tbody>

      </table>
    </div>
  </main>
</div>
