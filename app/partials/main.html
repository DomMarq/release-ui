<div ng-controller="MainController">

  <nav id="top-bar" class="navbar sticky-top navbar-light">
    <div class="navbar-header">
      <a id="top-bar-content" class="navbar-brand" href="/">
        <img src="/app/assets/images/logo.png" style="width:20%;">
        <span>ISTIO Releases</span>
      </a>
    </div>
  </nav>

  <main class="container p-5">
    <div class="active-cyan-3 active-cyan-4 mb-4 row">
      <div class="col-sm">
        <md-datepicker md-current-view="year" ng-model="startDate" ng-change="dateChange(true,startDate)"
          md-placeholder="From" md-max-date="maxFromDate"></md-datepicker>
      </div>
      <div class="col-sm">
        <md-datepicker md-current-view="year" ng-model="endDate" ng-change="dateChange(false,endDate)"
          md-placeholder="To" md-min-date="minToDate" md-max-date="maxDate"> </md-datepicker>
      </div>
      <div class="col-sm">
        <input type="radio" ng-model="filterDate" value="started" ng-click="whichDate = 0" default>
        <label>
          Filter by Creation Date
        </label>
        <br/>
        <input type="radio" ng-model="filterDate" value="modified" ng-click="whichDate = 1">
        <label>
          Filter by Modified Date
        </label>
      </div>
      <a href="/"><button type="button" class="btn btn-danger">Reset Filters</button></a>
    </div>
    <table id="release-table" ng-table="releaseTable" class="table">
        <thead>
          <th style="width: 13%">
            <div>
              <select class="form-control dropdown"
                ng-model="selectedValue"
                ng-options="state.id as state.status for state in stateValues track by state.id"
                ng-change="filterChange(true,selectedValue)">
                <option value="">Status</option>
              </select>
            </div>
          </th>
          <th>
            <button class="btn table-header" type="button" ng-click="sortChange(1)">
              Name
              <span ng-show="sortMethod == 1" class="caret">&#9660;</span>
              <span ng-show="sortMethod == 2" class="caret">&#9650;</span>
            </button>
          </th>
          <th>
            <button class="btn table-header" type="button" ng-click="sortChange(3)">
              Created
              <span ng-show="sortMethod == 3" class="caret">&#9660;</span>
              <span ng-show="sortMethod == 4" class="caret">&#9650;</span>
            </button>
          </th>
          <th>
            <button class="btn table-header" type="button" ng-click="sortChange(5)">
              Modified
              <span ng-show="sortMethod == 5" class="caret">&#9660;</span>
              <span ng-show="sortMethod == 6" class="caret">&#9650;</span>
            </button>
          </th>
          <th>
            <button class="btn table-header" type="button" ng-click="sortChange(7)">
              Last Task
              <span ng-show="sortMethod == 7" class="caret">&#9660;</span>
              <span ng-show="sortMethod == 8" class="caret">&#9650;</span>
            </button>
          </th>
          <th>
            <div>
              <select class="form-control dropdown"
                ng-model="selectedLabel"
                ng-options="label as label for label in labels"
                ng-change="filterChange(false,selectedLabel)">
                <option value="">All Tags</option>
              </select>
            </div>
          </th>
        </thead>
        <tbody id="dashboard">
            <tr ng-repeat="release in releases | limitTo:numPerPage:numPerPage*(currentPage-1)"
                ng-click="redirectToDetails(release)" ng-class="{greyed: hover}" ng-mouseenter="hover = true" ng-mouseleave="hover = false">
              <td style="width: 13%">
                <img ng-if="release.state == 2" src="/app/assets/images/check.png">
                <img ng-if="release.state == 3" src="/app/assets/images/error.png">
                <img ng-if="release.state == 1" src="/app/assets/images/pending.png">
                <img ng-if="release.state == 4" src="/app/assets/images/suspended.png">
              </td>
              <td>
                {{release.name}}
              </td>
              <td>
                {{release.started * 1000 | date:"MM/dd/yyyy 'at' h:mma"}}
              </td>
              <td>
                {{release.last_modified * 1000 | date:"MM/dd/yyyy 'at' h:mma"}}
              </td>
              <td>
                {{release.last_active_task}}
              </td>
              <td>
                <button ng-repeat="tag in release.labels "type="button" class="btn btn-secondary btn-sm">
                  {{tag}}
                </button>
              </td>
            </tr>
        </tbody>
        <tfoot>

        </tfoot>
    </table>

    <section id="footer">
      <ul class="pagination justify-content-center">
        <li class="page-item">
          <a ng-if="currentPage > 1" ng-click="pageChange(-2)" class="page-link" href="" aria-label="Next">
            <span aria-hidden="true">&laquo;</span>
          </a>
          <a ng-if="currentPage == 1" class="page-link" aria-label="Next">
            <span aria-hidden="true">&laquo;</span>
          </a>
        </li>
        <li ng-if="currentPage == 1" ng-repeat="n in [] | range:totalPages" class="page-item">
          <a ng-if="currentPage + $index == 1" class="page-link">{{currentPage + $index}}</a>
          <a ng-if="currentPage + $index != 1" ng-click="pageChange($index)" href="" class="page-link">{{currentPage + $index}}</a>
        </li>
        <li ng-if="currentPage > 1 && currentPage < totalPages" ng-repeat="n in [] | range:totalPages" class="page-item">
          <a ng-if="n == 0" class="page-link">{{currentPage}}</a>
          <a ng-if="n != 0" class="page-link" ng-click="pageChange(n)" href="">{{currentPage + n}}</a>
        </li>
        <li ng-if="currentPage >= totalPages && totalPages >= 3" class="page-item">
          <a ng-click="pageChange(-2)" href="" class="page-link">{{currentPage - 2}}</a>
        </li>
        <li ng-if="currentPage >= totalPages && totalPages >= 2" class="page-item">
          <a ng-click="pageChange(-1)" href="" class="page-link">{{currentPage -1}}</a>
        </li>
        <li ng-if="currentPage >= totalPages && currentPage != 1">
          <a class="page-link">{{currentPage}}</a>
        </li>
        <li>
          <a ng-if="currentPage < totalPages" ng-click="pageChange(1)" class="page-link" href="" aria-label="Next">
            <span aria-hidden="true">&raquo;</span>
          </a>
          <a ng-if="currentPage >= totalPages" class="page-link" aria-label="Next">
            <span aria-hidden="true">&raquo;</span>
          </a>
        </li>
      </ul>
    </section>
  </main>
</div>
